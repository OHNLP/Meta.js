<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta.js Test</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
html,body {
    width: 100%;
    height: 100%;
    font-size: 14px;
}
</style>
</head>
<body>
<div id="app_test"
    style="display: flex; flex-direction: row;">

    <fieldset>
        <legend>DATA</legend>
    </fieldset>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.1.1/math.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// load the meta.js first
$.getScript('./meta.js');

var app_test = {

};

var jarvis = {
    rs: null,
    testset: null,

    ssmsg: function(msg) {
        $('#ss-msg').html(msg);
    },

    ssclose: function() {
        $('#start-screen').hide();
    },

    init: function() {
        // init the app first
        app_test.init();

        // load data
        Papa.parse("./testsets/test_input.csv", {
            download: true,
            header: true,

            complete: function(rs) {
                console.log(rs);
                // bind data
                jarvis.rs = rs;

                // parse outcomes
                var outcomes = {};

                for (let i = 0; i < rs.data.length; i++) {
                    const r = rs.data[i];
                    if (!outcomes.hasOwnProperty(r.outcome)) {
                        outcomes[r.outcome] = [];
                    }
                    outcomes[r.outcome].push([
                        parseInt(r.Et), 
                        parseInt(r.Nt), 
                        parseInt(r.Ec), 
                        parseInt(r.Nc), 
                        r.study, r.treatment, r.control
                    ]);
                }

                outcomes = Object.values(outcomes);

                // set the data
                app_test.ocs = outcomes;
                app_test.vpp.$data.n_ocs = outcomes.length;
            }
        });

        // ok, show the UI
        if (!isCHROME) {
            var msg = 'The performance of calculation is affected by the JavaScript engine significantly, we recommend you to use <a href="https://v8.dev" target="_blank">V8</a> based web browser.<br>' + 
            'Try using latest <a target="_blank" href="https://www.google.com/chrome/">Google Chrome</a> or other <a target="_blank" href="https://download-chromium.appspot.com/">Chromium</a> based browsers (e.g., <a target="_blank" href="https://www.microsoft.com/en-us/edge">Microsoft Edge</a>, <a target="_blank" href="https://vivaldi.com/">Vivaldi</a>) to get best performance.<br> '+
'<a style="font-size:1.5em;" href="javascript:void(0);" onclick="jarvis.ssclose()">Continue to use <i class="fa fa-arrow-alt-circle-right"></i></a>';
            jarvis.ssmsg(msg);
        } else {
            jarvis.ssmsg('Initialized');
            setTimeout("jarvis.ssclose();", 1000);
        }
    }
};

$(document).ready(function() {
    jarvis.init();
});
</script>
</body>
</html>